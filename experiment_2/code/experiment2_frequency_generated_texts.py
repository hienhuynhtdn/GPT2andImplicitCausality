# -*- coding: utf-8 -*-
"""
Created on Mon Jun 27 14:46:35 2022

@author: Hien Huynh
"""

#%% IMPORT PACKAGES
import pandas as pd

#%% IMPORT DATAFRAME
df = pd.read_excel('./human_ratings/setup/Experiment selection.xlsx')

#%% FUNCTIONS

def split_sentence(sentence, separator):
    sentence = sentence.split(separator)[-1]
    
    # REMOVE SPACE AT THE BEGINNING OF STRING AND PUNCTUATION AT THE END
    sentence = sentence[1:-1]
    
    return sentence

#%% ANALYZE MOST FREQUENT TEXT GENERATIONS

# RAW OUTPUTS GENERATED BY THE MODEL
df['raw_generation'] = df['original_output'].apply(
    lambda x: split_sentence(x, 'because'))
# FREQUENCY OF RAW OUTPUTS BY SUBJECT GENDER
raw_generation_df = pd.DataFrame(df.groupby(['subject_gender','raw_generation']).size())
raw_generation_df = raw_generation_df.reset_index(drop=False)
raw_generation_df.rename(columns={0:'count'},inplace=True)
raw_generation_df = raw_generation_df.sort_values(by=['subject_gender','count'],ascending=False)
raw_generation_df = raw_generation_df.reset_index(drop=True)


# PROCESSED OUTPUTS
df['cleaned_generation'] = df['cleaned_output'].apply(
    lambda x: split_sentence(x, 'because'))

# FREQUENCY OF PROCESSED OUTPUTS BY SUBJECT GENDER
cleaned_generation_df = pd.DataFrame(df.groupby(['subject_gender','cleaned_generation']).size())
cleaned_generation_df = cleaned_generation_df.reset_index(drop=False)
cleaned_generation_df.rename(columns={0:'count'},inplace=True)
cleaned_generation_df = cleaned_generation_df.sort_values(by=['subject_gender','count'],ascending=False)
cleaned_generation_df = cleaned_generation_df.reset_index(drop=True)